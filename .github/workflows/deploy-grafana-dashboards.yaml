name: Deploy grafana dashboards

on: workflow_dispatch

jobs:
  deploy_grafana:
    runs-on: ubuntu-20.04
    strategy:
      # Don't stop other deployments if one fails
      fail-fast: false
      matrix:
        include:
          # To enable auto-deployments of grafana dashboards
          # for other clusters add its name and, a GitHub
          # secret for it and save its token to `grafana_token`
          - cluster_grafana_name: grafana.pilot
            grafana_token: secrets.GRAFANA_TOKEN
          - cluster_grafana_name: grafana.cloudbank
            grafana_token: secrets.GRAFANA_CLOUDBANK_TOKEN
          - cluster_grafana_name: grafana.carbonplan
            grafana_token: secrets.GRAFANA_CARBONPLAN_TOKEN
          - cluster_grafana_name: grafana.pangeo
            grafana_token: secrets.GRAFANA_PANGEO_TOKEN
          - cluster_grafana_name: pangeo-grafana.pangeo
            grafana_token: secrets.GRAFANA_PANGEO_HUBS_TOKEN
    steps:
      - name: Checkout jupyterhub/grafana-dashboards repo
        uses: actions/checkout@v2
        with:
          name: jupyterhub/grafana-dashboards
          path: ./grafana-dashboards
      - name: Deploy ${{ matrix.cluster_grafana_name }}
        env:
          GRAFANA_TOKEN: ${{ secrets.[matrix.grafana_token] }}
        run: |
          cd grafana-dashboards
          ./deploy.py ${{ matrix.cluster_grafana_name }}.2i2c.cloud 


