jupyterhub:
  ingress:
    hosts:
    - ucmerced.2i2c.cloud
    tls:
    - secretName: https-auto-tls
      hosts:
      - ucmerced.2i2c.cloud
  prePuller:
    continuous:
      enabled: true
  scheduling:
    userPlaceholder:
      # Keep at least one spare node around
      replicas: 1
      resources:
        requests:
          # Each node on the shared cluster has 60045228Ki of RAM
          # You can find this out by looking at the output of `kubectl get node <node-name> -o yaml`
          # Look under `allocatable`, not `capacity`. Unfortunately then you have to fiddle with it to
          # find the right number that's big enough that no user pods will schedule here, but small enough
          # that pods in `kube-system` will still schedule.
          # So even though this is under `userPlaceholder`, it really is operating as a `nodePlaceholder`
          # This value was arrived at by assuming that this works for utoronto, and taking the delta between `jupyterhub.scheduling.userPlaceholder.resources.memory` and the `capacity` above (2E6Ki)
          memory: 58045228Ki
  singleuser:
    nodeSelector:
      # Schedule on dedicated n2-highmem-8
      node.kubernetes.io/instance-type: n2-highmem-8
      2i2c.org/hub-name: ucmerced
    extraTolerations:
    - key: 2i2c.org/hub-name
      operator: Equal
      value: ucmerced
      effect: NoSchedule
    profileList:
    - display_name: Python
      description: Start a Python server with JupyterLab and scientific Python stack
      default: true
      kubespawner_override:
          # From https://github.com/SaiUCM/example-inherit-from-community-image
        image: quay.io/cirt_ucm/jupyter-scipy-xarray:1e26b42ad87b
            # Launch into JupyterLab after the user logs in
        default_url: /lab
      profile_options: &profile_options
        requests:
          display_name: Resource Allocation
          choices:
            mem_1:
              display_name: 1 GB RAM
              kubespawner_override:
                mem_guarantee: 995622387
                mem_limit: 995622387
              default: true
            mem_2:
              display_name: 2 GB RAM
              kubespawner_override:
                mem_guarantee: 1991244775
                mem_limit: 1991244775
    - display_name: R
      description: Start a R server with tidyverse & Geospatial tools
      kubespawner_override:
          # From https://github.com/2i2c-org/rocker-with-nbgitpuller
        image: quay.io/2i2c/rocker-with-nbgitpuller:3edc87d73e3d
        default_url: /lab
            # Ensures container working dir is homedir
            # https://github.com/2i2c-org/infrastructure/issues/2559
        working_dir: /home/rstudio
      profile_options: *profile_options
  hub:
    config:
      CILogonOAuthenticator:
        oauth_callback_url: https://ucmerced.2i2c.cloud/hub/oauth_callback
  custom:
    jupyterhubConfigurator:
      enabled: true
jupyterhub-home-nfs:
  gke:
    volumeId: projects/two-eye-two-see/zones/us-central1-b/disks/hub-nfs-homedirs-ucmerced
  quotaEnforcer:
    config:
      QuotaManager:
        hard_quota: 20
nfs:
  pv:
    serverIP: storage-quota-home-nfs.ucmerced.svc.cluster.local
