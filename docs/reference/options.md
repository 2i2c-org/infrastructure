# List of hub features

% NOTE: The CSV files used by this page are generated by `docs/scripts/generate-hub-features-table.py`

Here's the list of running hubs and the features they have enabled on them.
It is automatically generated from the config stored in the [`config/clusters` folder of the `infrastructure` repository](https://github.com/2i2c-org/infrastructure/tree/HEAD/config/clusters) and can therefore be limited in the information it provides.

## Hub options table

```{warning}
This is a work in progress and the current list of features is being tracked in the following [table](https://docs.google.com/spreadsheets/d/1ZRCAMyIBOSfPlfHywEKva7WG4-xNVKm18eAWGo_4KJQ/edit?usp=sharing).
```

<div class="full-width hub-options-table">

```{csv-table}
:header-rows: 1
:file: ../tmp/hub-options-table.csv
```

</div>

% DataTables config to make the table above look nice
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.min.css">
<script type="text/javascript" src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>

<script>
var checkbox = function (data, type) {
    if ( type === "sort" || type === 'type' ) {
      return data;
    }
    else {
      if (data.toString().trim() == "<p>True</p>") {
          return '<input type="checkbox" class="editor-active" onclick="return false;" checked>';
      }
      else {
          return '<input type="checkbox" onclick="return false;" class="editor-active">';
      }
    }
}

$(document).ready( function () {
    $('.hub-options-table table').DataTable( {
        "order": [[ 0, "template" ]],
        "pageLength": 25,
        "columns": [
            null, // domain column, nothing special configured
            {"render": checkbox}, // dedicated cluster column
            {"render": checkbox}, // dedicated nodepool column
            {"render": checkbox}, // user buckets (scratch/persistent) column
            {"render": checkbox}, // requestor pays for buckets storage column
            null, // authenticator column
            {"render": checkbox}, // user anonymisation column
            {"render": checkbox}, // allusers access column
            {"render": checkbox}, // community domain column
            {"render": checkbox}, // custom login page column
            {"render": checkbox}, // custom html pages column
            {"render": checkbox}, // gh-scoped-creds column
        ]
    });
} );
</script>

% Make the tables a little bit more compact since there's a lot of text
<style>
    table {
        font-size: .7em;
    }

    table th, table td {
        padding: 0;
    }
</style>

## Hub features decision tree

```{warning}
The following flowchart is a work in progress. There are two more layers that were intentional left out of this initial chart, `Knowledge sharing layer` and `Support and training layer`, as they are more complex and require additional research, that is not tied to infrastructure configurations.
```

% This is needed in order for tooltips to work in our docs per https://github.com/quarto-dev/quarto-cli/discussions/1054#discussioncomment-2882604

<style>
  .mermaidTooltip {
      position: absolute;
      text-align: center;
      max-width: 200px;
      padding: 2px;
      font-family: 'trebuchet ms', verdana, arial;
      font-size: 12px;
      background: #d9ead3;
      border: 1px solid #aaaa33;
      border-radius: 2px;
      pointer-events: none;
      z-index: 100;
    }
</style>


```{mermaid}

flowchart TB
    NewHub --> CloudLayer
    CloudLayer --> HubUserAccessLayer
    HubUserAccessLayer --> CommunityCustomizationsLayer
    CommunityCustomizationsLayer --> DataLayer
    DataLayer --> IntegrationsLayer
    IntegrationsLayer --> PerformanceLayer
    PerformanceLayer --> ElasticScaffolding

    subgraph CloudLayer
        Cluster -- default --> Shared
        cluster_one[2i2c, GCP, us-central1-b]
        cluster_two[2i2c-aws-us, AWS, us-west-2]
        cluster_three[2i2c-uk, GCP, europe-west2]
        Shared -- default --> cluster_one
        Shared --> cluster_two
        Shared --> cluster_three

        cluster_one --> plan_events{if events on hub}
        cluster_two --> plan_events
        cluster_three --> plan_events

        plan_events -- Yes --> ded_nodepool[Dedicated nodepool in shared cluster]
        plan_events -- default: No --> shared_nodepool[Shared nodepool]

        Cluster --> Dedicated
        Dedicated --> Provider
        Provider -- default --> GCP
        Dedicated --> Region
        Region -- default --> us_west_2
    end
    subgraph HubUserAccessLayer
        direction TB
        Authentication--> Username

        subgraph Authentication
            direction LR
            root_auth[Authenticator] -- default --> CILogonOAuthenticator
            root_auth --> GitHubOAuthenticator
            root_auth -- if ephemeral hub --> TmpAuthenticator

            CILogonOAuthenticator --> auth[authentication]
            click auth "https://www.cilogon.org/home" "Depends on the providers supported by CILogon"
            CILogonOAuthenticator --> cilogon_authorization[authorization]
            GitHubOAuthenticator --> github_authorization[authorization]

            auth --> SocialProvider
            auth -- if member of InCommon Federation --> InstitutionalProvider
            click InstitutionalProvider "https://cilogon.org/idplist/" "Click here to check if an institution's provider is supported by CILogon"


            SocialProvider --> Microsoft
            SocialProvider --> Google
            SocialProvider --> GitHub
            SocialProvider --> ORCID

            cilogon_authorization -- default --> domain_based[Domain matching]
            cilogon_authorization --> username_pattern[Username pattern matching]
            cilogon_authorization --> allowed_users[Membership in allowed users list]

            github_authorization -- default --> teams[GitHub Teams membership status]
            github_authorization --> org[GitHub Organizations membership status]
            github_authorization --> allowed_users
        end

        subgraph Username
            u[ID] --> anonymous
            u --> public
            public -- default --> email
            public --> claim[provider specific claim]
        end
    end

    subgraph CommunityCustomizationsLayer
        cclayer[*] --> hub_pages
        cclayer --> hub_domain
        hub_pages[Hub pages]
        hub_domain[Hub domain]

        hub_pages --> option_one
        hub_pages --  optional and only for straightforward, short HTML --> option_two

        hub_domain --> community_name.cluster_name.2i2c.cloud
        hub_domain --> community_name.2i2c.cloud
        hub_domain -- community must set a CNAME that points to the 2i2c domain --> other

        option_one[Hub Login Page]
        option_two[Other Hub pages]
        login_page_option_one[Basic configuration of template sections]
        login_page_option_two[Self configuration through own GitHub repo]

        option_one --> login_options
        login_options -- mandatory --> login_page_option_one
        login_options -- optional --> login_page_option_two

        login_page_option_one --> OrganizationInfo
        login_page_option_one --> FundedBy

        login_page_option_two -- default 2i2c-org/default-hub-homepage --> RepoURL
        login_page_option_two -- default master --> RepoBranch

        OrganizationInfo --> OrgName
        OrganizationInfo --> OrgURL
        OrganizationInfo --> logoURL

        FundedBy --> FunderName
        FundedBy --> FunderURL
    end

    subgraph DataLayer
        data[*] --> data_root_option_one
        data --> data_root_option_two
        data_root_option_one[Shared Data Directories]
        data_root_option_two[Object Storage Buckets]

        shared_readwrite[shared-readwrite]
        shared_public[shared-public]
        data_root_option_one -- enabled by default --> shared_dir
        data_root_option_one -- enabled by default --> shared_readwrite
        data_root_option_one -- optional --> shared_public
        data_root_option_one -- optional --> allusers

        data_root_option_two --> Scratch
        data_root_option_two --> Persistent

        hub_cloud_permissions[Cloud Permissions]
        Scratch --> hub_cloud_permissions
        Persistent --> hub_cloud_permissions

        public_bucket[Publicly accessible]
        from_hub[Buckets accessible from the Hub]
        outside_hub[Buckets accessible from outside the Hub]
        requestor_pays[Requestor Pays]

        hub_cloud_permissions --> outside_hub
        hub_cloud_permissions -- default --> from_hub
        hub_cloud_permissions -- GCP only --> requestor_pays

        outside_hub --> public_bucket
        gg_membership[Google Groups based membership]
        outside_hub -- GCP only --> gg_membership
    end

    subgraph IntegrationsLayer
        integrations[*] --> gh-scoped-creds[Allow users to push to GitHub from the hub]
        integrations --> git-credential-helpers[Enable nbgitpuller for private GitHub repos]
        integrations -- only dedicated clusters --> Grafana
        integrations -- currently broken --> static_webs[fa:fa-exclamation Authenticated static websites]
        integrations --> Configurator
    end

    subgraph PerformanceLayer
        perf[*] --> GPUs
        GPUs -- optional --> profile[GPU user profile]
        perf --> Dask
        perf --> KernelCulling 
    end

    subgraph ElasticScaffolding
        ProfileLists --> HardwareProfiles
        ProfileLists --> UserImageSelectors
        ProfileLists --> NodeSharing
    end

```

