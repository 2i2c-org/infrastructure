name: Regenerate SMCE credentials
on:
  workflow_dispatch:
  schedule:
    - cron: "0 0 6 1,4,7,10 *"
    - cron: "0 0 25 2,5,8,11 *"
  # January 6 → February 25 → April 6 → May 25, and so on.
  # This means a new issue will be opened every 40 to 50 days

jobs:
  create_issue:
    name: Create credentials regeneration issue
    runs-on: ubuntu-latest
    permissions:
      issues: write
    steps:
      - name: Get Deadline
        id: get_deadline
        # The deadline is 4 days after the issue is opened
        run: echo "deadline=$(date -d '+4 days' +'%B %d')" >> $GITHUB_ENV

      - name: Create credentials regeneration issue
        run: |
          gh issue create \
            --label "recurrent" \
            --title "[$DEADLINE] Regenerate NASA SMCE credentials"
            --template "🔐 Regenerate NASA SMCE credentials")
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GH_REPO: ${{ github.repository }}
          DEADLINE: ${{ env.deadline }}
