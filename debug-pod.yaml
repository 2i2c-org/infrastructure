apiVersion: v1
kind: Pod
metadata:
  name: jupyter-debugging
  namespace: prod
spec:
  affinity:
    nodeAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - preference:
            matchExpressions:
              - key: hub.jupyter.org/node-purpose
                operator: In
                values:
                  - user
          weight: 100
  containers:
    - name: busybox
      image: busybox
      command: ["sh", "-c", "sleep infinity"]
      securityContext:
        runAsUser: 0
      volumeMounts:
        - mountPath: /nfs
          name: home
        - mountPath: /home/jovyan
          name: home
          subPath: fperez
        - mountPath: /home/jovyan/shared
          name: home
          subPath: _shared
        - mountPath: /home/jovyan/shared-public
          name: home
          subPath: _shared_public
      resources:
        requests:
          cpu: 225m
          memory: "939524096"
  nodeSelector:
    2i2c.org/node-cpu: "4"
  schedulerName: prod-user-scheduler
  serviceAccountName: s3-full-access
  tolerations:
    - effect: NoSchedule
      key: hub.jupyter.org/dedicated
      operator: Equal
      value: user
    - effect: NoSchedule
      key: hub.jupyter.org_dedicated
      operator: Equal
      value: user
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300
  volumes:
    - name: home
      persistentVolumeClaim:
        claimName: home-nfs
