# List of hub features

% NOTE: The CSV files used by this page are generated by `docs/scripts/generate-hub-features-table.py`

Here's the list of running hubs and the features they have enabled on them.
It is automatically generated from the config stored in the [`config/clusters` folder of the `infrastructure` repository](https://github.com/2i2c-org/infrastructure/tree/HEAD/config/clusters) and can therefore be limited in the information it provides.

## Hub options table

<div class="full-width hub-options-table">

```{csv-table}
:header-rows: 1
:file: ../tmp/hub-options-table.csv
```

</div>

% DataTables config to make the table above look nice
<link rel="stylesheet"
      href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.min.css">
<script type="text/javascript"
        src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>

<script>
var checkbox = function (data) {
    var c = data.toString().trim()
    console.log(c)
    if (c == "<p>True</p>") {
        return '<input type="checkbox" class="editor-active" onclick="return false;" checked>';
    }
    else {
        return '<input type="checkbox" onclick="return false;" class="editor-active">';
    }
}

$(document).ready( function () {
    $('.hub-options-table table').DataTable( {
        "order": [[ 0, "template" ]],
        "pageLength": 25,
        "columns": [
            null, // domain column, nothing special configured
            {"render": checkbox}, // dedicated cluster column
            {"render": checkbox}, // dedicated nodepool column
            {"render": checkbox}, // user buckets (scratch/persistent) column
            {"render": checkbox}, // requestor pays for buckets storage column
            null, // authenticator column
            {"render": checkbox}, // user anonymisation column
            {"render": checkbox}, // allusers access column
            {"render": checkbox}, // community domain column
            {"render": checkbox}, // custom login page column
            {"render": checkbox}, // custom html pages column
            {"render": checkbox}, // gh-scoped-creds column
        ]
    });
} );
</script>

% Make the tables a little bit more compact since there's a lot of text
<style>
    table {
        font-size: .7em;
    }

    table th, table td {
        padding: 0;
    }
</style>

## Hub features decision tree

```{mermaid}
stateDiagram-v2
    NewHub --> CloudLayer
    CloudLayer --> HubUserAccessLayer
    HubUserAccessLayer --> CommunityCustomizationsLayer
    CommunityCustomizationsLayer --> DataLayer

    state CloudLayer {
        Cluster --> shared: default
        cluster_one: 2i2c, GCP, us-central1-b
        cluster_two: 2i2c-aws-us, AWS, us-west-2
        cluster_three: 2i2c-uk, GCP, europe-west2
        shared --> cluster_one: default
        shared --> cluster_two
        shared --> cluster_three

        state plan_events <<choice>>
        cluster_one --> plan_events
        cluster_two --> plan_events
        cluster_three --> plan_events

        plan_events --> dedicated_nodepool: if events on hub
        plan_events --> shared_nodepool : default no events

        Cluster --> dedicated
        dedicated --> provider
        provider --> GCP: default
        dedicated --> region
        region --> us_west_2: default
    }
    state HubUserAccessLayer {
        [*] --> Authentication
        Authentication--> Username

        state Authentication {
            [*] --> CILogonOAuthenticator : default
            [*] --> GitHubOAuthenticator
            [*] --> TmpAuthenticator : if ephemeral hub

            state auth <<join>>
            state cilogon_authorization <<join>>
            state github_authorization <<join>>


            CILogonOAuthenticator --> auth: authentication
            CILogonOAuthenticator --> cilogon_authorization: authorization
            GitHubOAuthenticator --> github_authorization: authorization

            auth --> SocialProvider
            auth --> InstitutionalProvider: if member of InCommon Federation

            state options <<join>>
            SocialProvider --> options: options
            options --> Microsoft
            options --> Google
            options --> GitHub

            cilogon_authorization --> domain_based: default
            cilogon_authorization --> username_pattern
            cilogon_authorization --> allowed_users

            github_authorization --> GitHubTeams_membership: default
            github_authorization --> GitHubOrgs_membership
            github_authorization --> allowed_users
        }

        state Username {
            [*] --> public
            public --> email : default
            claim: provider specific claim
            public --> claim
            [*] --> anonymous
        }
    }
    state CommunityCustomizationsLayer {
        [*] --> root_option_one
        [*] --> root_option_two
        root_option_one: Hub pages
        root_option_two: Hub domain

        root_option_one --> option_one
        root_option_one --> option_two : only for straightforward, short HTML

        root_option_two --> community_name.cluster_name.2i2c.cloud
        root_option_two --> community_name.2i2c.cloud
        root_option_two --> other: community must set a CNAME that points to the 2i2c domain

        option_one: Hub Login Page
        option_two: (Optional) Other Hub pages
        login_page_option_one: Basic configuration of template sections
        login_page_option_two: Self configuration through own GitHub repo

        state login_options <<join>>
        option_one --> login_options
        login_options --> login_page_option_one: mandatory
        login_options --> login_page_option_two: optional

        login_page_option_one --> OrganizationInfo
        login_page_option_one --> FundedBy

        login_page_option_two --> RepoURL : default 2i2c-org/default-hub-homepage
        login_page_option_two --> RepoBranch : default master

        OrganizationInfo --> OrgName
        OrganizationInfo --> OrgURL
        OrganizationInfo --> logoURL

        FundedBy --> FunderName
        FundedBy --> FunderURL
    }
    state DataLayer {
        [*] --> data_root_option_one
        [*] --> data_root_option_two
        data_root_option_one: Shared Data Directories
        data_root_option_two: Object Storage Buckets

        state data_root_option_one {
            shared_readwrite: shared-readwrite
            shared_public: shared-public
            [*] --> shared_dir: enabled by default
            [*] --> shared_readwrite: enabled by default
            [*] --> shared_public: optional
            [*] --> allusers: optional
        }

        state data_root_option_two {
            [*] --> Scratch
            [*] --> Persistent

            state buckets <<join>>
            Scratch --> buckets
            Persistent --> buckets

            hub_cloud_persmissions: Cloud Permissions
            buckets --> hub_cloud_persmissions

            public_bucket: Publicly accessible
            from_hub: Buckets accessible from the Hub
            outside_hub: Buckets accessible from outside the Hub
            requestor_pays: Requestor Pays

            hub_cloud_persmissions --> outside_hub
            hub_cloud_persmissions --> from_hub : default
            hub_cloud_persmissions --> requestor_pays : GCP only


            outside_hub --> public_bucket
            gg_membership: Google Groups based membership
            outside_hub --> gg_membership : GCP only
        }
    }

```