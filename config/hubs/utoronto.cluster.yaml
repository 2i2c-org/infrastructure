name: utoronto
provider: kubeconfig
kubeconfig:
  file: secrets/utoronto.yaml
support:
  config:
    prometheus:
      server:
        resources:
          requests:
            cpu: 0.5
            memory: 4Gi
          limits:
            cpu: 2
            memory: 16Gi
    grafana:
      ingress:
        hosts:
          - grafana.utoronto.2i2c.cloud
hubs:
  - name: staging
    domain: staging.utoronto.2i2c.cloud
    template: basehub
    auth0:
      enabled: false
    config: &utorontoHubConfig
      jupyterhub:
        custom:
          homepage:
            templateVars:
              org:
                name: University of Toronto
                logo_url: https://raw.githubusercontent.com/utoronto-2i2c/homepage/master/extra-assets/images/home-hero.png
                url: https://www.utoronto.ca/
              designed_by:
                name: 2i2c
                url: https://2i2c.org
              operated_by:
                name: 2i2c
                url: https://2i2c.org
              funded_by:
                name: University of Toronto
                url: https://www.utoronto.ca/
        singleuser:
          image:
            name: quay.io/2i2c/utoronto-image
            tag: 83a724f5b829
        scheduling:
          userPlaceholder:
            enabled: false
            replicas: 0
          userScheduler:
            resources:
              requests:
                cpu: 0.1
                memory: 512Mi
              limits:
                memory: 512Mi
        proxy:
          chp:
            resources:
              requests:
                cpu: 0.1
                memory: 128Mi
              limits:
                memory: 512Mi
          traefik:
            resources:
              requests:
                cpu: 0.1
                memory: 256Mi
              limits:
                memory: 512Mi
        hub:
          requests:
            cpu: 0.3
            memory: 512Mi
          limits:
            memory: 2Gi
          allowNamedServers: true
          readinessProbe:
            enabled: false
          config:
            Authenticator:
              enable_auth_state: false
              admin_users:
                - 7c76d04b-2a80-4db1-b985-a2d2fa2f708c
                - 09056164-42f5-4113-9fd7-dd852e63ff1d
                - adb7ebad-9fb8-481a-bc2c-6c0a8b6de670
            JupyterHub:
              authenticator_class: azuread
            AzureAdOAuthenticator:
              username_claim: oid
              login_service: "University of Toronto ID"
              oauth_callback_url: https://staging.us-central1-b.gcp.pangeo.io/hub/oauth_callback
              tenant_id: 78aac226-2f03-4b4d-9037-b46d56c55210
          extraConfig:
            10-dynamic-subpath: |
              import os
              pod_namespace = os.environ['POD_NAMESPACE']
              # FIXME: This isn't setting up _shared dirs properly
              c.KubeSpawner.volume_mounts = [
                {
                  "mountPath": "/home/jovyan",
                  "name": "home",
                  "subPath": f"{pod_namespace}/{{username}}"
                },
              ]

