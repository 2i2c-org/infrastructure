nfs:
  pv:
    # from https://docs.aws.amazon.com/efs/latest/ug/mounting-fs-nfs-mount-settings.html
    mountOptions:
      - rsize=1048576
      - wsize=1048576
      - timeo=600
      - soft # We pick soft over hard, so NFS lockups don't lead to hung processes
      - retrans=2
      - noresvport
    serverIP: fs-08652322ea83653b1.efs.ca-central-1.amazonaws.com
    baseShareName: /

jupyterhub:
  custom:
    2i2c:
      add_staff_user_ids_to_admin_users: true
      add_staff_user_ids_of_type: "google"
    homepage:
      templateVars:
        org:
          name: UBC EOAS
          logo_url: https://brand.ubc.ca/files/2018/09/Logos_1_2CrestDownload_768px.jpg
          url: https://www.eoas.ubc.ca/
        designed_by:
          name: 2i2c
          url: https://2i2c.org
        operated_by:
          name: 2i2c
          url: https://2i2c.org
        funded_by:
          name: UBC EOAS
          url: https://www.eoas.ubc.ca/

  hub:
    config:
      Authenticator:
        admin_users:
          - ckrzysik # Technical representative, Charles Krzysik
          - lheagy # Technical representative, Lindsey Heagy
          - hmodzelewski # Technical representative, Henryk Modzelewski
      JupyterHub:
        authenticator_class: cilogon
      CILogonOAuthenticator:
        shown_idps:
          - https://authentication.ubc.ca
          - http://google.com/accounts/o8/id
        allowed_idps:
          https://authentication.ubc.ca:
            username_derivation:
              username_claim: email
              action: strip_idp_domain
              domain: eoas.ubc.ca
          http://google.com/accounts/o8/id:
            username_derivation:
              username_claim: email
            allowed_domains:
              - 2i2c.org

  singleuser:
    defaultUrl: /lab
    memory:
      # Based on measurements of observed usage
      guarantee: 1G
      limit: 1G
    cpu:
      # Based on measurements of observed usage
      guarantee: 0.1
      limit: 4
    nodeSelector:
      node.kubernetes.io/instance-type: r5.2xlarge
    profileList:
      - display_name: EOSC211
        description: "For class EOSC211, provides ~2 CPU and ~8G RAM"
        default: true
        kubespawner_override:
          # Using 'latest' for now so updates do not require 2i2c
          # involvement.
          image: quay.io/henrykmodzelewski/2i2c-eosc211:latest
      - display_name: EOSC350
        description: "For class EOSC350, provides ~2 CPU and ~8G RAM"
        kubespawner_override:
          # Using 'latest' for now so updates do not require 2i2c
          # involvement.
          image: quay.io/henrykmodzelewski/2i2c-eosc350:latest
  scheduling:
    userScheduler:
      enabled: true
