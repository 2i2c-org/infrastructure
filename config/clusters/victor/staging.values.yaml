basehub:
  nfs:
    pv:
      serverIP: 10.100.237.53
  userServiceAccount:
    annotations:
      eks.amazonaws.com/role-arn: arn:aws:iam::129856558350:role/victor-staging
  dask-gateway:
    gateway:
      backend:
        scheduler:
          extraPodConfig:
            nodeSelector:
              2i2c/hub-name: staging
        worker:
          extraPodConfig:
            nodeSelector:
              2i2c/hub-name: staging
  jupyterhub-home-nfs:
    eks:
      volumeId: vol-0a4147126b73d7ff9
    quotaEnforcer:
      config:
        QuotaManager:
          hard_quota: 5 # in GiB
  jupyterhub:
    ingress:
      hosts: [staging.hub.victorproject.org]
      tls:
      - hosts: [staging.hub.victorproject.org]
        secretName: https-auto-tls
    hub:
      config:
        CILogonOAuthenticator:
          oauth_callback_url: https://staging.hub.victorproject.org/hub/oauth_callback
    singleuser:
      nodeSelector:
        2i2c/hub-name: staging
      profileList:
        # IMPORTANT: Staging and prod's profileList's are meant to be kept
        #            equivalent with the exception that staging adds
        #            unlisted_choice to pick a custom image. If you update
        #            either, update the other as well.
        #
      - display_name: CPU Only
        profile_options:
          image: &profile_option_image
            display_name: Image
            choices:
              a-victor-notebook:
                display_name: Victor Notebook
                default: true
                kubespawner_override:
                  image: quay.io/volcanocyber/victor-notebook:4a4884b1dffb
              b-pytorch-notebook:
                display_name: Pangeo ML Notebook (Pytorch)
                kubespawner_override:
                  image: quay.io/pangeo/pytorch-notebook:2024.09.11
              c-ml-notebook:
                display_name: Pangeo ML Notebook (Tensorflow)
                kubespawner_override:
                  image: quay.io/pangeo/ml-notebook:2024.09.11
            unlisted_choice:
              enabled: true
              display_name: Custom image
              validation_regex: ^.+:.+$
              validation_message: Must be a publicly available docker image, of form <image-name>:<tag>
              kubespawner_override:
                image: '{value}'
          resource_allocation:
            display_name: Resource Allocation
            choices:
                # r5.xlarge
                # [[[cog
                # from deployer.dev_commands.generate.resource_allocation.generate_choices import choices
                # choices(["r5.xlarge:4"], "proportional-memory-strategy", default=True)
                # ]]]
              mem_4_gb:
                display_name: ~4 GB RAM, ~0.5 CPUs
                description: Up to ~4 CPUs when available
                kubespawner_override:
                  mem_guarantee: 3902839759
                  mem_limit: 3902839759
                  cpu_guarantee: 0.4563125
                  cpu_limit: 3.6505
                  node_selector:
                    node.kubernetes.io/instance-type: r5.xlarge
                default: true
              mem_7_gb:
                display_name: ~7 GB RAM, ~0.9 CPUs
                description: Up to ~4 CPUs when available
                kubespawner_override:
                  mem_guarantee: 7805679519
                  mem_limit: 7805679519
                  cpu_guarantee: 0.912625
                  cpu_limit: 3.6505
                  node_selector:
                    node.kubernetes.io/instance-type: r5.xlarge
              mem_15_gb:
                display_name: ~15 GB RAM, ~1.8 CPUs
                description: Up to ~4 CPUs when available
                kubespawner_override:
                  mem_guarantee: 15611359038
                  mem_limit: 15611359038
                  cpu_guarantee: 1.82525
                  cpu_limit: 3.6505
                  node_selector:
                    node.kubernetes.io/instance-type: r5.xlarge
              mem_29_gb:
                display_name: ~29 GB RAM, ~4 CPUs
                description: ~4 CPUs always available
                kubespawner_override:
                  mem_guarantee: 31222718077
                  mem_limit: 31222718077
                  cpu_guarantee: 3.6505
                  cpu_limit: 3.6505
                  node_selector:
                    node.kubernetes.io/instance-type: r5.xlarge
                # [[[end]]]

                # r5.4xlarge
                # [[[cog
                # from deployer.dev_commands.generate.resource_allocation.generate_choices import choices
                # choices(["r5.4xlarge:2"], "proportional-memory-strategy")
                # ]]]
              mem_60_gb:
                display_name: ~60 GB RAM, ~8 CPUs
                description: Up to ~15 CPUs when available
                kubespawner_override:
                  mem_guarantee: 64020707016
                  mem_limit: 64020707016
                  cpu_guarantee: 7.69055
                  cpu_limit: 15.3811
                  node_selector:
                    node.kubernetes.io/instance-type: r5.4xlarge
              mem_119_gb:
                display_name: ~119 GB RAM, ~15 CPUs
                description: ~15 CPUs always available
                kubespawner_override:
                  mem_guarantee: 128041414033
                  mem_limit: 128041414033
                  cpu_guarantee: 15.3811
                  cpu_limit: 15.3811
                  node_selector:
                    node.kubernetes.io/instance-type: r5.4xlarge
                # [[[end]]]
      - display_name: NVIDIA Tesla T4, ~16 GB, ~4 CPUs
        description: Start a container on a dedicated node with a GPU
        slug: gpu
        kubespawner_override:
          environment:
            NVIDIA_DRIVER_CAPABILITIES: compute,utility
          mem_limit:
          mem_guarantee: 14G
          node_selector:
            node.kubernetes.io/instance-type: g4dn.xlarge
          extra_resource_limits:
            nvidia.com/gpu: '1'
        profile_options:
          image: *profile_option_image
