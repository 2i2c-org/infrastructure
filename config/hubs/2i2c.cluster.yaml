name: 2i2c
image_repo: "quay.io/2i2c/2i2c-hubs-image"
provider: gcp
gcp:
  key: secrets/2i2c.json
  project: two-eye-two-see
  cluster: pilot-hubs-cluster
  zone: us-central1-b
support:
  config:
    grafana:
      ingress:
        hosts:
          - grafana.pilot.2i2c.cloud
        tls:
          - secretName: grafana-tls
            hosts:
              - grafana.pilot.2i2c.cloud
hubs:
  - name: staging
    domain: staging.pilot.2i2c.cloud
    template: basehub
    auth0:
      connection: google-oauth2
    config:
      docs_service:
        enabled: true
        repo: https://github.com/jupyterhub/nbgitpuller
        branch: gh-pages
      jupyterhub:
        custom:
          homepage:
            templateVars:
              org:
                name: 2i2c Staging
                url: https://2i2c.org
                logo_url: https://2i2c.org/media/logo.png
              designed_by:
                name: 2i2c
                url: https://2i2c.org
              operated_by:
                name: 2i2c
                url: https://2i2c.org
              funded_by:
                name: 2i2c
                url: https://2i2c.org
        hub:
          config:
            Authenticator:
              allowed_users: &staging_users
                # this will be replaced with the actual list of
                # staff google ids by the deployer script
                - <staff_google_ids>
                - colliand@gmail.com
              admin_users: *staging_users
  - name: dask-staging
    domain: dask-staging.pilot.2i2c.cloud
    template: daskhub
    auth0:
      connection: google-oauth2
    config:
      basehub:
        jupyterhub:
          custom:
            cloudResources:
              provider: gcp
              gcp:
                projectId: two-eye-two-see
              scratchBucket:
                enabled: true
            homepage:
              templateVars:
                org:
                  name: 2i2c Dask Staging
                  url: https://2i2c.org
                  logo_url: https://2i2c.org/media/logo.png
                designed_by:
                  name: 2i2c
                  url: https://2i2c.org
                operated_by:
                  name: 2i2c
                  url: https://2i2c.org
                funded_by:
                  name: 2i2c
                  url: https://2i2c.org
          singleuser:
            image:
              name: pangeo/pangeo-notebook
              tag: 2021.02.19
          hub:
            config:
              Authenticator:
                allowed_users: &dask_staging_users
                  - <staff_google_ids>
                  - colliand@gmail.com
                admin_users: *dask_staging_users
  - name: demo
    domain: demo.pilot.2i2c.cloud
    template: basehub
    auth0:
      connection: CILogon
    config:
      jupyterhub:
        custom:
          homepage:
            templateVars:
              org:
                name: 2i2c Demo Hub
                url: https://2i2c.org
                logo_url: https://2i2c.org/media/logo.png
              designed_by:
                name: 2i2c
                url: https://2i2c.org
              operated_by:
                name: 2i2c
                url: https://2i2c.org
              funded_by:
                name: 2i2c
                url: https://2i2c.org
        hub:
          config:
            Authenticator:
              admin_users:
                - <staff_google_ids>
              username_pattern: '^(.+@2i2c\.org|deployment-service-check)$'
  - name: ohw
    domain: ohw.pilot.2i2c.cloud
    template: daskhub
    auth0:
      connection: github
    config:
      basehub:
        jupyterhub:
          prePuller:
            continuous:
              enabled: true
          singleuser:
            networkPolicy:
              # In clusters with NetworkPolicy enabled, do not
              # allow outbound internet access that's not DNS, HTTP or HTTPS
              # For OHW, we allow 8080 (for DAP) and 22 (for ssh)
              # https://github.com/2i2c-org/pilot-hubs/issues/549#issuecomment-892276020
              enabled: true
              egress:
                - ports:
                    - port: 53
                      protocol: UDP
                - ports:
                    - port: 80
                      protocol: TCP
                - ports:
                    - port: 443
                      protocol: TCP
                - ports:
                    - port: 8080
                      protocol: TCP
                - ports:
                    - port: 22
                      protocol: TCP
            image:
              name: ghcr.io/oceanhackweek/jupyer-image
              tag: 9efd4fb
            memory:
              # Increase memory alloted during the workshop
              #  https://github.com/2i2c-org/pilot-hubs/issues/549#issuecomment-891264570
              guarantee: 7G
              limit: 8G
          custom:
            cloudResources:
              provider: gcp
              gcp:
                projectId: two-eye-two-see
              scratchBucket:
                enabled: true
            homepage:
              templateVars:
                org:
                  name: Ocean Hack Week
                  logo_url: https://avatars.githubusercontent.com/u/33128979
                  url: https://oceanhackweek.github.io/
                designed_by:
                  name: 2i2c
                  url: https://2i2c.org
                operated_by:
                  name: 2i2c
                  url: https://2i2c.org
                funded_by:
                  name: 2i2c
                  url: https://2i2c.org
          hub:
            config:
              Authenticator:
                allowed_users: &ohw_users
                  - <staff_github_ids>
                  - ocefpaf
                admin_users: *ohw_users
  - name: justiceinnovationlab
    domain: justiceinnovationlab.pilot.2i2c.cloud
    template: basehub
    auth0:
      connection: github
    config:
      jupyterhub:
        custom:
          homepage:
            templateVars:
              org:
                name: Justice Innovation Lab
                logo_url: "https://images.squarespace-cdn.com/content/5ee35ddb35affc21b29c0fd6/1596634079158-KLDENW5BSW2HQW4ZO0EH/JIL-Logo-Digital.png?format=1500w&content-type=image%2Fpng"
                url: https://www.justiceinnovationlab.org/
              designed_by:
                name: 2i2c
                url: https://2i2c.org
              operated_by:
                name: 2i2c
                url: https://2i2c.org
              funded_by:
                name: 2i2c
                url: https://2i2c.org
        hub:
          config:
            Authenticator:
              admin_users:
                - <staff_github_ids>
                - donaldbraman
                - JILPulvino
  - name: pfw
    domain: pfw.pilot.2i2c.cloud
    template: basehub
    auth0:
      connection: github
    config:
      jupyterhub:
        custom:
          homepage:
            templateVars:
              org:
                name: Purdue Fort Wayne
                logo_url: https://upload.wikimedia.org/wikipedia/en/thumb/1/14/Purdue_Fort_Wayne_Mastodons_logo.svg/400px-Purdue_Fort_Wayne_Mastodons_logo.svg.png
                url: https://www.pfw.edu/
              designed_by:
                name: 2i2c
                url: https://2i2c.org
              operated_by:
                name: 2i2c
                url: https://2i2c.org
              funded_by:
                name: JROST & IOI
                url: https://investinopen.org/blog/jrost-rapid-response-fund-awardees
        hub:
          config:
            Authenticator:
              allowed_users: &pfw_users
                - <staff_github_ids>
                - colliand
                - alessandromariaselvitella
                - fosterk86
              admin_users: *pfw_users
  - name: peddie
    domain: peddie.pilot.2i2c.cloud
    template: basehub
    auth0:
      connection: google-oauth2
    config:
      jupyterhub:
        custom:
          homepage:
            templateVars:
              org:
                name: Peddie Academy
                logo_url: https://resources.finalsite.net/images/f_auto,q_auto,t_image_size_1/v1564687841/peddie/l4yufwwdksquxu2yetv6/PeddieSealPMS289.png
                url: http://peddie.org/
              designed_by:
                name: 2i2c
                url: https://2i2c.org
              operated_by:
                name: 2i2c
                url: https://2i2c.org
              funded_by:
                name: JROST & IOI
                url: https://investinopen.org/blog/jrost-rapid-response-fund-awardees
        hub:
          config:
            Authenticator:
              allowed_users: &peddie_users
                - <staff_google_ids>
                - rbennett@peddie.org
                - msawula@peddie.org
                - ericvd@berkeley.edu
              admin_users: *peddie_users
  - name: catalyst-cooperative
    domain: catalyst-cooperative.pilot.2i2c.cloud
    template: daskhub
    auth0:
      connection: google-oauth2
    config:
      basehub:
        jupyterhub:
          singleuser:
            image:
              name: catalystcoop/pudl-jupyter
              tag: 2021.11.11
            memory:
              limit: 6G
              guarantee: 4G
          custom:
            cloudResources:
              provider: gcp
              gcp:
                projectId: two-eye-two-see
              scratchBucket:
                enabled: true
            homepage:
              templateVars:
                org:
                  name: Catalyst Cooperative
                  logo_url: https://catalyst.coop/files/2018/06/SimpleSquareWalking.png
                  url: https://catalyst.coop/
                designed_by:
                  name: 2i2c
                  url: https://2i2c.org
                operated_by:
                  name: 2i2c
                  url: https://2i2c.org
                funded_by:
                  name: 2i2c
                  url: https://2i2c.org
          hub:
            config:
              Authenticator:
                allowed_users: &catalyst_users
                  - <staff_google_ids>
                  - zane.selvans@catalyst.coop
                  - cgosnell@catalyst.coop
                  - colliand@gmail.com
                admin_users: *catalyst_users
  - name: earthlab
    domain: earthlab.pilot.2i2c.cloud
    template: basehub
    auth0:
      connection: github
    config:
      jupyterhub:
        custom:
          homepage:
            templateVars:
              org:
                name: EarthLab
                logo_url: https://pbs.twimg.com/profile_images/1102342372438925312/64xKJFPk.png
                url: https://www.colorado.edu/earthlab/
              designed_by:
                name: 2i2c
                url: https://2i2c.org
              operated_by:
                name: 2i2c
                url: https://2i2c.org
              funded_by:
                name: JROST & IOI
                url: https://investinopen.org/blog/jrost-rapid-response-fund-awardees
        hub:
          config:
            Authenticator:
              allowed_users: &earthlab_users
                - <staff_github_ids>
                - lwasser
              admin_users: *earthlab_users
  - name: paleohack2021
    domain: paleohack2021.hackathon.2i2c.cloud
    template: basehub
    auth0:
      connection: github
    config:
      jupyterhub:
        scheduling:
          userPlaceholder:
            # Not needed anymore, hackathon is over
            replicas: 0
          userScheduler:
            # Each user gets almost 1 anyway
            enabled: true
        custom:
          homepage:
            templateVars:
              org:
                name: "PaleoHack 2021"
                logo_url: "https://raw.githubusercontent.com/LinkedEarth/Logos/master/pyleoclim_logo_full_white.png"

                url: "https://linkedearth.github.io/paleoHackathon/"
              designed_by:
                name: 2i2c
                url: https://2i2c.org
              operated_by:
                name: 2i2c
                url: https://2i2c.org
              funded_by:
                name: "NSF Paleo Perspectives on Climate Change program"
                url: "https://www.nsf.gov/funding/pgm_summ.jsp?pims_id=5750"
        singleuser:
          memory:
            guarantee: 256M
            limit: 4G
          cpu:
            guarantee: 0.1
            limit: 2
          image:
            name: quay.io/2i2c/paleohack-2021
            tag: 7534858b1098
        hub:
          config:
            Authenticator:
              allowed_users: &paleohack_users
                - <staff_github_ids>
                - CommonClimate
                - khider
                - fzhu2e
                - alexkjames
              admin_users: *paleohack_users
  - name: aup
    domain: aup.pilot.2i2c.cloud
    template: basehub
    auth0:
      connection: github
    config:
      jupyterhub:
        custom:
          homepage:
            templateVars:
              org:
                name: The American University of Paris
                logo_url: https://www.aup.edu/sites/default/files/images/widget-assets/image/auplogo.jpeg
                url: https://www.aup.edu/
              designed_by:
                name: 2i2c
                url: https://2i2c.org
              operated_by:
                name: 2i2c
                url: https://2i2c.org
              funded_by:
                name: AUP
                url: https://www.aup.edu/
        singleuser:
          memory:
            limit: 2G
            guarantee: 2G
        hub:
          config:
            Authenticator:
              allowed_users: &aup_users
                - <staff_github_ids>
                - swalker
                - shaolintl
              admin_users: *aup_users
