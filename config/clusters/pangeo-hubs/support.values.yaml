grafana:
  grafana.ini:
    server:
      root_url: https://grafana.gcp.pangeo.2i2c.cloud/
    auth.github:
      enabled: true
      allowed_organizations: 2i2c-org
  ingress:
    hosts:
      - grafana.gcp.pangeo.2i2c.cloud
    tls:
      - secretName: grafana-tls
        hosts:
          - grafana.gcp.pangeo.2i2c.cloud

# Disable the Admissions Validation Webhook and the port is not
# permitted on private GKE clusters
ingress-nginx:
  controller:
    admissionWebhooks:
      enabled: false

prometheusIngressAuthSecret:
  enabled: true

prometheus:
  server:
    extraInitContainers:
      # Prometheus sometimes seems to run into bugs where the 'write ahead log'
      # used for recovery from crashes and network failures gets massive, and
      # requires an order of magnitude more RAM to start up than usual (see
      # https://github.com/prometheus/prometheus/issues/6934). Deleting the WAL
      # at each startup means we *might* lose some data during restarts, but
      # that is far preferable to having the entire prometheus server be down.
      # This should be only done for prometheus instances that seem to crash
      # with messages about loading from the WAL in their logs.
      - name: kill-wal
        image: busybox
        command:
          [
            "sh",
            "-c",
            "rm -rvf /data/wal/*",
          ]
        securityContext:
          runAsGroup: 65534
          runAsNonRoot: true
          runAsUser: 65534
        volumeMounts:
          - mountPath: /data
            name: storage-volume
    persistentVolume:
      size: 200Gi
    ingress:
      enabled: true
      hosts:
        - prometheus.gcp.pangeo.2i2c.cloud
      tls:
        - secretName: prometheus-tls
          hosts:
            - prometheus.gcp.pangeo.2i2c.cloud
