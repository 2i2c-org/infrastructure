# This is a *super* opinionated configuration file for automatic dependency bumps
# managed by Dependabot: https://github.blog/2020-06-01-keep-all-your-packages-up-to-date-with-dependabot/
#
# Folks were concerned about the noise generated by the bot and so we have made the
# following trade-offs to reduce this:
# 1. Check for updates monthly
# 2. Do not check for patch bumps
# 3. Phase in each package-ecosystem and allow the dependencies for one ecosystem to
#    settle before introducing the next eco-system
# Further steps we can take to reduce noise:
# - Limit the number of Pull Requests Dependabot is allowed to open at once. Currently,
#   the default limit is five (5) open PRs.
#
# Team discussion located in: https://github.com/2i2c-org/infrastructure/issues/1012
#
# Full configuration options can be found here:
# https://docs.github.com/en/code-security/supply-chain-security/keeping-your-dependencies-updated-automatically/configuration-options-for-dependency-updates
#
# `directory` is a required field that can only take one value. Therefore, to
# locate the different requirements.txt files throughout the repo, we must define
# multiple rules with a specific path for `directory`

version: 2
updates:
  # Maintain dependencies for GitHub Actions in workflow files
  # By default, the directory to be checked is .github/workflows for the github-actions
  # package ecosystem
  # ref: https://docs.github.com/en/code-security/dependabot/working-with-dependabot/keeping-your-actions-up-to-date-with-dependabot
  - package-ecosystem: "github-actions"
    directory: "/"
    schedule:
      # Check for updates once a week. By default, this check happens on a Monday.
      interval: "monthly"
    ignore:
      # Ignore patch upgrades to further reduce noise
      - update-types: ["version-update:semver-patch"]
        dependency-name: "*" # Match all packages
    reviewers:
      - "2i2c-org/engineering"
  # Maintain dependencies for GitHub Actions in our setup-deploy action
  - package-ecosystem: "github-actions"
    directory: "/.github/actions/setup-deploy/"
    schedule:
      # Check for updates once a week. By default, this check happens on a Monday.
      interval: "monthly"
    ignore:
      # Ignore patch upgrades to further reduce noise
      - update-types: ["version-update:semver-patch"]
        dependency-name: "*" # Match all packages
    reviewers:
      - "2i2c-org/engineering"
  # Maintain dependencies for pip defined in project root (deployer module)
  - package-ecosystem: "pip"
    directory: "/"
    schedule:
      # Check for updates once a week. By default, this check happens on a Monday.
      interval: "monthly"
    ignore:
      # Ignore patch upgrades to further reduce noise
      - update-types: ["version-update:semver-patch"]
        dependency-name: "*" # Match all packages
    reviewers:
      - "2i2c-org/engineering"
  # Maintain dependencies for pip defined in docs folder (documentation)
  - package-ecosystem: "pip"
    directory: "/docs"
    schedule:
      # Check for updates once a week. By default, this check happens on a Monday.
      interval: "monthly"
    ignore:
      # Ignore patch upgrades to further reduce noise
      - update-types: ["version-update:semver-patch"]
        dependency-name: "*" # Match all packages
    reviewers:
      - "2i2c-org/engineering"
  # Signal pip dependencies updates in helm-charts/images/hub folder (default hub image)
  - package-ecosystem: "pip"
    directory: "/helm-charts/images/hub"
    schedule:
      # Check for updates once a week. By default, this check happens on a Monday.
      interval: "monthly"
    ignore:
      # Ignore patch upgrades to further reduce noise
      - update-types: ["version-update:semver-patch"]
        dependency-name: "*" # Match all packages
    reviewers:
      - "2i2c-org/engineering"
    labels:
      # This dependabot PRs should not be merged as is, because additional manual steps are required also.
      # Checkout https://infrastructure.2i2c.org/en/latest/topic/infrastructure/hub-image.html#updating-the-hub-image
      - "requires follow-up"
