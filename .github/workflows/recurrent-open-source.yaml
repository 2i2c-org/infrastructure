name: 'Recurrent: Upstream OSS Contributions'
on:
  workflow_dispatch:
  schedule:
  - cron: 0 4 * * 3

jobs:
  # Run the action every other week
  run-fortnightly:
    runs-on: ubuntu-latest
    permissions:
      issues: write
    steps:
    - uses: actions/checkout@v6
    - name: Check if valid week
      continue-on-error: false
      run: |
        WEEK=$(date +%V)
        if [ $((${WEEK#0} % 2)) -ne 0 ]; then
            echo "Skipping this week"
            exit 1
        fi
    - name: Get Deadline
      id: get_deadline
      run: |
        echo "deadline=$(date -d '+28 days' +'%B %d')" >> $GITHUB_ENV
        echo "deadline_as_iso_date=$(date -d '+28 days' +"%Y-%m-%d")" >> $GITHUB_ENV

    - name: Setup recurrent issue for dedicated clusters billing
      uses: ./.github/actions/setup-recurrent-issues
      with:
        label: good-community-citizen
        title: '[${{ env.deadline }}] Upstream OSS Contributions'
        body: |
          ### Context

          See this 2i2c blog post on [Foundational Contributions](https://2i2c.org/blog/foundational-contributions/)

          ### What we need to do

          Gather ideas for upstream OSS upstream in this issue to play for the next iteration. Cap or split the work into 2 or 3 points for effort.

          Take a look at [JupyterHub PR triage board](https://github.com/orgs/jupyterhub/projects/4/views/9) for inspiration ðŸŒˆ

          ### Definition of Done

          - [ ] We agree on a contribution to work on for next iteration.
        fields: Status,Estimate,End date
        values: Up Next,2,${{ env.deadline_as_iso_date }}
        GH_TOKEN: ${{ secrets.PROJECT_BOARD_PAT_TOKEN }}
